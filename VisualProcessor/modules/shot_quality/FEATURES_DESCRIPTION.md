# Описание фичей модуля shot_quality

> **v2 update**: модуль перешёл на **NPZ output** и `BaseModule`.
> Human-friendly распаковка и контракт зависимостей описаны в `README.md` этого модуля.

## 1. Sharpness (Резкость)

### sharpness_tenengrad
Основная метрика резкости кадра. Вычисляется на основе градиентов Собеля как среднее значение суммы квадратов градиентов по горизонтали и вертикали. Более робастна к шуму по сравнению с чистым Laplacian.

### sharpness_secondary
Компактная secondary‑метрика резкости, агрегирующая несколько вспомогательных показателей (Laplacian, SMD2, edge clarity, градиент‑фокус) в одно число. Используется как дополнительный признак к `sharpness_tenengrad`.

### motion_blur_probability
Вероятность размытия движения, оцениваемая через анализ частотного спектра FFT: чем меньше средняя величина спектра относительно максимума, тем выше вероятность motion blur. Рекомендуется использовать в связке с оптическим потоком как отдельный признак от дефокус‑блюра.

### spatial_frequency_mean
Масштаб‑нормализованная средняя пространственная частота изображения: вычисляется в частотной области FFT с нормировкой радиуса на диагональ кадра, что делает метрику сопоставимой для разных разрешений.

## 2. Noise (Шум)

### noise_model_mean
Модельный уровень шума, агрегированный из DnCNN и (опционально) CBDNet: усреднённое значение карт шума, используемое как proxy ISO/качества экспозиции.

### noise_cbdnet_stats
Статистики шума из модели CBDNet: среднее значение, стандартное отклонение и энергия карты шума для цветного изображения (служебная/диагностическая фича при наличии CBDNet).

### noise_level_luma
Уровень шума в яркостном канале, оцениваемый через среднее абсолютное различие между оригинальным и размытым по Гауссу изображением, нормализованное к [0, 1].

### noise_level_chroma
Уровень шума в цветовых каналах (U и V в YUV пространстве), вычисляемый как среднее отклонение от размытых значений в цветовых каналах.

### noise_chroma_ratio
Отношение цветного шума к яркостному: `noise_level_chroma / (noise_level_luma + eps)`. Полезно для различения шума, связанного с высоким ISO, и цветовых артефактов.

### iso_estimated_value
Оценка ISO значения на основе уровня шума: линейная интерполяция от 100 до 6400 в зависимости от уровня шума в яркостном канале.

### grain_strength
Сила зерна оценивается через стандартное отклонение высокочастотных компонентов, полученных с помощью фильтра высоких частот.

### noise_spatial_entropy
Пространственная энтропия шума вычисляется как средняя энтропия гистограмм яркости в блоках 8x8 пикселей.

## 3. Exposure (Экспозиция)

### underexposure_ratio
Доля пикселей в темных областях, вычисляемая относительно 5‑го перцентиля яркости (p5). Все пиксели ниже p5 считаются недоэкспонированными.

### overexposure_ratio
Доля пикселей в светлых областях, вычисляемая относительно 95‑го перцентиля яркости (p95). Все пиксели выше p95 считаются переэкспонированными.

### midtones_balance
Баланс средних тонов — доля пикселей в диапазоне `[p5, p95]`. Отражает, насколько значимая часть изображения находится в рабочем динамическом диапазоне.

### exposure_histogram_skewness
Асимметрия гистограммы экспозиции вычисляется через энтропию распределения яркостей, показывая смещение экспозиции.

### highlight_recovery_potential
Потенциал восстановления светов вычисляется как дополнение доли переэкспонированных пикселей до единицы.

### shadow_recovery_potential
Потенциал восстановления теней вычисляется как дополнение доли недоэкспонированных пикселей до единицы.

## 4. Contrast (Контраст)

### contrast_global
Глобальный контраст вычисляется как стандартное отклонение яркости всех пикселей изображения.

### contrast_local
Локальный контраст вычисляется как среднее абсолютное значение оператора Лапласа, отражающее контраст на уровне деталей.

### contrast_dynamic_range
Динамический диапазон контраста - нормализованная разница между максимальной и минимальной яркостью в изображении.

### contrast_clarity_score
Оценка четкости контраста как комбинация локального контраста и средней величины градиента, нормализованная к [0, 1].

### microcontrast
Микроконтраст оценивается через стандартное отклонение высокочастотных компонентов, полученных с помощью лапласиана второго порядка.

## 5. Color Quality (Качество цвета)

### wb_r, wb_g, wb_b
Компоненты баланса белого - средние значения красного, зеленого и синего каналов изображения, показывающие цветовой сдвиг.

### color_cast_type
Тип цветового оттенка определяется по доминирующему каналу: "red", "green", "blue" или "neutral" в зависимости от максимального среднего значения.

### skin_tone_accuracy_score
Точность передачи тона кожи оценивается через анализ пикселей в диапазоне тонов кожи в HSV: проверяется правильность соотношения R > G > B.

### color_fidelity_index
Индекс цветовой точности вычисляется через энтропию гистограммы оттенков (H в HSV), нормализованную к [0, 1], показывающую разнообразие и точность цветов.

### color_noise_level
Уровень цветового шума оценивается через стандартное отклонение цветовых каналов a и b в пространстве LAB от их размытых версий.

### color_uniformity_score
Оценка равномерности цвета вычисляется как дополнение до единицы нормализованной суммы стандартных отклонений всех компонентов HSV.

## 6. Compression Artifacts (Артефакты сжатия)

### compression_blockiness_score
Оценка блочности сжатия вычисляется как среднее абсолютное различие между пикселями с шагом 8 (стандартный размер блока JPEG/MPEG).

### banding_intensity
Интенсивность полосатости оценивается через различие между оригинальным и размытым изображением: чем меньше различие, тем выше полосатость.

### ringing_artifacts_level
Уровень артефактов ringing (звона) вокруг резких краев оценивается через стандартное отклонение отклика специального фильтра, детектирующего осцилляции.

### bitrate_estimation_score
Оценка битрейта основана на комбинации метрик блочности и полосатости: чем больше артефактов, тем ниже оценка битрейта.

### codec_artifact_entropy
Энтропия артефактов кодека вычисляется через энтропию гистограммы стандартных отклонений блоков 8x8, отражая структурированность артефактов сжатия.

## 7. Lens Quality (Качество объектива)

### vignetting_level
Уровень виньетирования вычисляется как разность между средней яркостью центральной области и углов изображения.

### chromatic_aberration_level
Уровень хроматической аберрации оценивается через среднее различие краев в красном и синем каналах, полученных детектором Canny.

### distortion_type
Тип дисторсии объектива определяется через анализ кривизны линий: "barrel" (бочкообразная), "pincushion" (подушкообразная) или "none" на основе расстояния линий от центра.

### lens_sharpness_drop_off
Снижение резкости к краям вычисляется как относительное падение резкости в углах по сравнению с центром через оператор Лапласа.

### lens_obstruction_probability
Вероятность препятствий на объективе оценивается через долю пикселей с большими локальными отклонениями яркости от размытой версии.

### lens_dirt_probability
Вероятность грязи на объективе определяется через количество маленьких темных областей на адаптивно пороговом изображении.

### veiling_glare_score
Оценка veiling glare (засветки) вычисляется как произведение доли ярких пикселей и инверсии контраста, отражая общее снижение контраста из-за рассеянного света.

## 8. Atmospheric Conditions (Атмосферные условия)

### fog_haziness_score
Оценка тумана и дымки вычисляется как обратная величина дисперсии оператора Лапласа: меньше резкость - больше туман.

## 9. Temporal Metrics (Временные метрики)

### temporal_flicker_score
Оценка мерцания между кадрами вычисляется как среднее абсолютное различие яркостей между текущим и предыдущим кадром.

### rolling_shutter_artifacts_score
Оценка артефактов rolling shutter вычисляется через вариацию вертикального потока оптического потока по горизонтальным полосам, показывая нелинейные искажения при быстром движении.

## 10. Shot Quality Classification (Классификация качества кадра)

### quality_cinematic_prob
Вероятность кинематографического качества оценивается через zero-shot классификацию CLIP с промптом "cinematic shot, high-quality professional footage".

### quality_lowlight_cinematic_prob
Вероятность качественного низкоосвещенного кинематографического кадра через CLIP классификацию с соответствующим промптом.

### quality_smartphone_good_prob
Вероятность хорошего качества смартфона через CLIP классификацию.

### quality_smartphone_poor_prob
Вероятность плохого качества смартфона (шумное, зернистое) через CLIP классификацию.

### quality_webcam_prob
Вероятность качества веб-камеры низкого разрешения через CLIP классификацию.

### quality_screenrecord_prob
Вероятность качества записи экрана через CLIP классификацию.

### quality_surveillance_prob
Вероятность качества камеры видеонаблюдения низкого качества через CLIP классификацию.

### aesthetic_score
Эстетическая оценка кадра вычисляется как взвешенная комбинация яркости и контраста изображения, отражающая визуальную привлекательность.

### clip_embedding
Векторное представление кадра размерности 768 из модели CLIP ViT-L/14, представляющее семантическое описание изображения в пространстве CLIP.

## 11. Aggregated Features (Агрегированные фичи)

### frame_features
Статистические агрегаты по всем кадрам: для каждой числовой фичи вычисляются среднее (avg), стандартное отклонение (std), минимум (min) и максимум (max), отражающие распределение метрик качества во времени.

## 12. Temporal Features (Временные фичи)

### temporal_sharpness_stability
Стабильность резкости во времени вычисляется как дополнение до единицы коэффициента вариации (стандартное отклонение / среднее) истории резкости по кадрам.

### temporal_exposure_stability
Стабильность экспозиции во времени аналогично оценивается через коэффициент вариации истории значений midtones_balance.

### exposure_consistency_over_time
Консистентность экспозиции вычисляется как дополнение до единицы стандартного отклонения истории экспозиции, показывая насколько стабильна экспозиция между кадрами.

### temporal_noise_variation
Вариация уровня шума во времени вычисляется как коэффициент вариации истории уровней шума, показывая насколько изменчив шум между кадрами.

