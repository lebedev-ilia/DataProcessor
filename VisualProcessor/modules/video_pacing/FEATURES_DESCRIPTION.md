# Описание фичей модуля video_pacing

## 1. Shot Features (Характеристики кадров)

### shot_duration_mean
Средняя длительность шотов в секундах. Шоты детектируются по комбинации признаков между соседними кадрами (SSIM, цветовая гистограмма, изменение границ/яркости), а слишком короткие шоты (< `min_shot_length_seconds`, по умолчанию ~0.15s) объединяются с соседними, чтобы убрать шум.

### shot_duration_median
Медианная длительность шотов в секундах; более устойчива к выбросам, чем среднее.

### shot_duration_min
Минимальная длительность шота в секундах.

### shot_duration_max
Максимальная длительность шота в секундах.

### shot_duration_std
Стандартное отклонение длительностей шотов в секундах, отражающее вариативность темпа монтажа.

### shot_duration_entropy
Энтропия распределения длительностей шотов, вычисляемая по гистограмме (20 бинов). Высокая энтропия указывает на разнообразие длин шотов.

### shot_duration_mean_normalized
Средняя длительность шота, нормализованная на длину видео:  
`shot_duration_mean_normalized = shot_duration_mean / video_length_seconds`. Полезна для сравнения роликов разной длины.

### shot_length_gini
Коэффициент Джини по длительностям шотов (0..1). Высокие значения означают сильное неравенство (смешение очень коротких и очень длинных шотов).

### cuts_per_10s
Средняя частота склеек на 10 секунд видео, вычисляемая по скользящим окнам длиной 10 секунд.

### cuts_per_10s_max
Максимальная частота склеек в любом 10-секундном окне (характеризует "burstiness" монтажа).

### cuts_per_10s_median
Медианная частота склеек по всем 10-секундным окнам.

### cuts_variance
Дисперсия длительностей шотов в секундах; высокая дисперсия указывает на нерегулярный темп.

### short_shot_fraction
Доля шотов короче заданного порога (по умолчанию 0.5s). Позволяет оценить, насколько монтаж тяготеет к "быстрым" шотам.

### quick_cut_burst_count
Количество "бурстов" быстрых склеек: число раз, когда в течение 1 секунды попадает как минимум 3 cut'а. Отражает наличие очень динамичных фрагментов.

### shot_length_histogram_5bins
Вектор из 5 значений — доли шотов в бинах по длительности: very_short, short, medium, long, very_long (пороги заданы в секундах). Удобно как компактное представление распределения длины шотов.

### tempo_entropy
Энтропия распределения длительностей шотов по 5 бинам (дополняет `shot_duration_entropy` и чувствительна к форме распределения).

### cut_density_map_8bins
Вектор длиной 8 — плотность cut'ов (склеек) по 8 равным временным сегментам видео (cut-ов в секунду по каждому сегменту). Можно использовать как агрегат и как последовательный сигнал для трансформера.

> Прежние фичи `longest_shot_duration` и `shortest_shot_duration` были алиасами `shot_duration_max` / `shot_duration_min` и удалены как дублирующие.

## 2. Pace Curve (Кривая темпа)

### pace_curve_mean
Среднее значение длительностей шотов (в секундах), идентично `shot_duration_mean`.

### pace_curve_slope
Наклон кривой темпа, вычисляемый через линейную регрессию лог-длительностей шотов во времени. Отрицательный наклон означает тенденцию к ускорению темпа (шоты укорачиваются), положительный — к замедлению.

### pace_curve_slope_normalized
Нормализованный наклон `pace_curve_slope`, умноженный на среднюю длительность шота. Интерпретируется как относительное изменение длительности шотов по мере продвижения ролика.

### pace_curve_peaks
Количество локальных максимумов (пиков) в последовательности длительностей шотов (замедления), найденных через `find_peaks` с параметрами prominence/дистанции.

### pace_curve_peaks_mean_prominence
Средняя prominence пиков длительностей шотов — характеризует выраженность замедлений.

### pace_curve_peak_positions
Список нормализованных позиций пиков (0..1) по оси шотов (от начала к концу видео).

### pace_curve_periodicity
> Заменена на более явные фичи:

### pace_curve_dominant_period_sec
Доминирующий период ритма монтажа в секундах, оцененный по автокорреляции последовательности длительностей шотов.

### pace_curve_power_at_period
Нормализованная мощность автокорреляции на доминирующем периоде (0..1). Чем выше, тем более "шаблонный"/ритмичный монтаж.

## 3. Scene Pacing (Темп сцен)

### scene_changes_per_minute
Частота смены **сцен** на минуту видео. В текущей упрощённой реализации сцены приравнены к шотам (alias), поэтому метрика фактически совпадает с частотой шотов; при добавлении полноценного scene detection будет пересчитана.

### average_scene_duration
Средняя длительность сцены в секундах (на текущем этапе — средняя длительность шота как alias).

### scene_duration_variance
Дисперсия длительностей сцен (на текущем этапе — шотов), показывающая вариативность темпа на "сценовом" уровне.

## 4. Motion Features (Характеристики движения)

### mean_motion_speed_per_shot
Средняя скорость движения по кадрам, вычисляемая по кривой `core_optical_flow.motion_px_per_sec_mean` (RAFT/torchvision) между соседними сэмплированными кадрами (после лёгкого сглаживания). Отражает общую интенсивность движения в видео.

### motion_speed_median
Медианная скорость движения по кадрам.

### motion_speed_variance
Дисперсия скоростей движения по кадрам; высокая дисперсия указывает на чередование статичных и динамичных фрагментов.

### motion_speed_90perc
90-й перцентиль скоростей движения; отражает пиковую интенсивность.

### share_of_high_motion_frames
Доля кадров с высокой скоростью движения, вычисляемая как доля кадров, где сглаженный модуль оптического потока превышает 75-й перцентиль **по видео**. Показывает долю динамичных фрагментов.

### share_of_high_motion_shots
Доля шотов, чья средняя скорость движения превышает 75-й перцентиль среди всех шотов.

### motion_shot_corr
Корреляция Пирсона между длительностью шота и его средней скоростью движения (по модулю оптического потока). Часто отрицательная: более динамичные фрагменты = короткие шоты.

### optical_flow_direction_changes_per_second
Частота резких изменений направления движения в секунду. В текущей версии `core_optical_flow` не возвращает углы, поэтому метрика временно равна 0.0 (заглушка под future schema upgrade).

## 5. Content Change Rate (Скорость изменения контента)

### frame_embedding_diff_mean
Среднее значение изменений семантического контента между кадрами, вычисляемое через cosine distance между нормализованными CLIP-эмбеддингами соседних кадров (после сглаживания скользящим окном). Отражает среднюю скорость семантических изменений.

### frame_embedding_diff_std
Стандартное отклонение изменений семантического контента. Высокое значение указывает на чередование статичных и резко меняющихся семантических фрагментов.

### high_change_frames_ratio
Доля кадров с высоким изменением контента: изменение embedding превышает 75-й перцентиль по видео.

### scene_embedding_jumps
Количество резких семантических скачков, определяемых как кадры, где сглаженное изменение embedding превышает \(mean + 2\sigma\). Указывает на количество значительных переходов между сценами или концептами.

### semantic_change_burst_count
Количество "бурстов" семантических изменений: кластеров, где в интервале до 5 секунд подряд встречается ≥3 высокоизменяющихся кадра. Отражает наличие участков с очень быстрой сменой смыслового контента.

## 6. Color Pacing (Темп изменения цвета)

### color_histogram_diff_mean
Среднее значение цветовых различий между кадрами, вычисляемое через DeltaE в LAB цветовом пространстве для perceptual точности. Отражает среднюю скорость изменения цвета.

### color_histogram_diff_std
Стандартное отклонение цветовых различий, показывающее вариативность скорости изменения цвета. Высокое значение указывает на нерегулярные цветовые переходы.

### color_change_bursts
Количество "бурстов" цветовых изменений: пиков в detrended DeltaE (после вычитания локального baseline), превышающих порог \(mean + 2\sigma\). Помогает выявлять участки с резкими сменами цветовых схем.

### saturation_change_rate
Скорость изменения насыщенности цветов, вычисляемая через стандартное отклонение средних значений насыщенности (S канал в HSV) по всем кадрам. Отражает динамику цветовой насыщенности.

### brightness_change_rate
Скорость изменения яркости, вычисляемая через стандартное отклонение средних значений яркости (V канал в HSV) по всем кадрам. Отражает динамику освещения и яркости.

## 7. Lighting Pacing (Темп изменения освещения)

### luminance_spikes_per_minute
Частота всплесков яркости на минуту, вычисляемая как количество кадров, где абсолютная дельта яркости превышает порог шума (максимум между STD и фиксированным минимумом), делённое на длительность видео в минутах. Отражает частоту реальных вспышек освещения (без учёта мелкого шума/автоэкспозиции).

### high_frequency_flash_ratio
Доля высокочастотных вспышек в изменении яркости, вычисляемая через FFT-анализ последовательности дельт яркости. Считается как отношение мощности частот выше 0.25 Nyquist к общей мощности. Высокое значение указывает на наличие быстрых вспышек и мерцаний.

## 8. Structural Pacing (Структурный темп)

### intro_speed
Скорость темпа в начале видео (интро), вычисляемая как медианная длительность шотов в первой четверти последовательности шотов (в секундах). Отражает темп завязки и привлечения внимания зрителя.

### main_speed
Скорость темпа в основной части видео, вычисляемая как медианная длительность шотов в средней половине видео. Отражает основной ритм повествования.

### climax_speed
Скорость темпа в "кульминации" видео, вычисляемая как медианная длительность шотов в последней четверти последовательности шотов. В дальнейшем может быть привязана к реальному climax из `story_structure`.

### pacing_symmetry
Симметрия ритма монтажа, вычисляемая как нормализованная разность между `climax_speed` и `intro_speed`, делённая на общую медианную длительность шотов. Отрицательное значение означает ускорение к финалу, положительное — замедление, около нуля — более симметричный темп.

