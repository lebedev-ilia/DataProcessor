# Описание фичей модуля cut_detection

## 1. Hard Cuts (Жесткие склейки)

### hard_cuts_count
Количество жестких склеек в видео. Жесткая склейка детектируется через комбинацию четырех сигналов: различие гистограмм HSV (L1 норма), падение SSIM, скачок оптического потока и различие deep embeddings. Каждый сигнал добавляет единицу к счету, и склейка считается обнаруженной при счете >= 2. Для повышения робастности применяется морфологическая очистка (удаление изолированных детекций) и медианная фильтрация для устранения ложных срабатываний.

### hard_cut_strength_mean
Средняя сила жестких склеек, вычисляемая как среднее значение комбинированных счетов всех обнаруженных склеек. Сила отражает количество сработавших сигналов (от 2 до 4).

### hard_cut_strength_p25, hard_cut_strength_p50, hard_cut_strength_p75
Перцентили распределения сил жестких склеек (25-й, 50-й и 75-й перцентили). Позволяют анализировать распределение сил склеек, а не только среднее значение.

### hard_cuts_per_minute
Частота жестких склеек на минуту видео, вычисляемая как отношение общего количества склеек к длительности видео в минутах.

## 2. Soft Cuts (Мягкие переходы)

### fade_in_count
Количество fade-in переходов. Детектируется через монотонное увеличение яркости в HSV и LAB пространствах с проверкой консистентности оптического потока для исключения движения камеры.

### fade_out_count
Количество fade-out переходов. Детектируется через монотонное уменьшение яркости в HSV и LAB пространствах с проверкой консистентности оптического потока.

### dissolve_count
Количество dissolve переходов. Детектируется через плавное изменение гистограмм HSV без резких скачков яркости, но с постепенным изменением распределения цветов. Улучшенная детекция исключает экспозиционные изменения (глобальные изменения яркости) через проверку корреляции гистограмм и анализа градиентов яркости. Также проверяется линейная смесь гистограмм (плавная корреляция изменений), характерная для dissolve.

### avg_fade_duration
Средняя длительность fade переходов в секундах, вычисляемая как среднее значение длительностей всех обнаруженных fade-in и fade-out переходов.

## 3. Motion-based Cuts (Движение-основанные переходы)

### motion_cuts_count
Общее количество движение-основанных переходов (whip pan, zoom, speed ramp). Детектируется через анализ скачков величины оптического потока с адаптивным порогом на основе 95-го перцентиля. Используется компенсация движения камеры через RANSAC homography для различения движения камеры от движения объектов. Для больших разрешений применяется обработка в уменьшенном разрешении (256x256) для ускорения вычислений.

### motion_cut_intensity_score
Средняя интенсивность движение-основанных переходов, вычисляемая как среднее значение величин оптического потока в точках переходов.

### flow_spike_ratio
Отношение количество движение-основанных переходов к количеству жестких склеек, показывающее долю переходов, вызванных движением камеры.

### whip_pan_transitions_count
Количество whip pan переходов. Детектируется через высокую консистентность направления оптического потока (consistency > 0.6) в сочетании с высокой величиной потока, что указывает на резкое панорамирование камеры.

### zoom_transition_count
Количество zoom переходов. Детектируется через низкую консистентность направления потока в сочетании с высокой величиной потока, что указывает на изменение масштаба без панорамирования.

### speed_ramp_cuts_count
Количество speed ramp переходов. Детектируется через высокую дисперсию величины оптического потока по кадру (быстрое движение в центре, медленное на краях) в сочетании с высокой средней величиной потока.

## 4. Stylized Transitions (Стилизованные переходы)

### transition_*_count (glitch, flash, wipe, slide, luma_wipe и др.)
Количество стилизованных переходов каждого типа, детектируемых через CLIP zero-shot классификацию с мультимодальным входом (оригинал | разность кадров | визуализация оптического потока). Для оптимизации вычислений используется candidate-first подход: CLIP запускается только на кандидатных окнах, отфильтрованных через легковесные сигналы (изменение гистограмм, падение SSIM, скачок оптического потока), что снижает вычислительную нагрузку в 5-20 раз.

### transition_flash_transition_count
Количество flash переходов, детектируемых через CLIP классификацию переходов с резким изменением яркости.

### transition_wipe_transition_count
Количество wipe переходов, детектируемых через CLIP классификацию переходов с горизонтальным или вертикальным "стиранием" кадра.

### transition_slide_transition_count
Количество slide переходов, детектируемых через CLIP классификацию переходов со скользящим эффектом.

### transition_luma_wipe_transition_count
Количество luma wipe переходов, детектируемых через CLIP классификацию переходов с яркостным стиранием.

## 5. Jump Cuts (Прыжковые склейки)

### jump_cuts_count
Количество прыжковых склеек. Детектируется через анализ изменения позы и лица (MediaPipe) в сочетании с проверкой схожести фона через deep embeddings. Jump cut определяется как большое изменение позы/лица (адаптивный порог на основе уверенности) при сохранении похожего фона (cosine similarity > 0.85). Улучшенная детекция использует face ID embeddings для более точного определения того же человека и применяет маскирование области лица/позы при сравнении фона для исключения влияния изменений переднего плана.

### jump_cut_intensity
Средняя интенсивность прыжковых склеек, вычисляемая как среднее значение комбинированного изменения позы и лица для всех обнаруженных jump cuts.

### jump_cut_ratio_per_minute
Частота прыжковых склеек на минуту видео, вычисляемая как отношение количества jump cuts к длительности видео в минутах.

## 6. Cut Timing Statistics (Статистика времени склеек)

### cuts_per_minute
Частота склеек в минуту, вычисляемая как отношение общего количества жестких склеек к длительности видео в минутах. (Примечание: cuts_per_second удален как дублирующая метрика).

### median_cut_interval
Медианный интервал между склейками в секундах, вычисляемый как медиана всех интервалов между последовательными склейками.

### min_cut_interval
Минимальный интервал между склейками в секундах, показывающий самую короткую паузу между склейками.

### max_cut_interval
Максимальный интервал между склейками в секундах, показывающий самую длинную паузу между склейками.

### cut_interval_std
Стандартное отклонение интервалов между склейками, отражающее вариативность ритма монтажа.

### cut_interval_cv
Коэффициент вариации (coefficient of variation) интервалов между склейками, вычисляемый как std/mean. Показывает относительную вариативность ритма независимо от абсолютных значений интервалов.

### cut_interval_entropy
Нормализованная энтропия распределения интервалов между склейками, вычисляемая через гистограмму интервалов (20 бинов) и нормализованная делением на log(#bins) для получения значений в диапазоне [0, 1]. Высокая энтропия указывает на разнообразие ритма.

### cut_rhythm_uniformity_score
Оценка равномерности ритма склеек, вычисляемая как 1 - CV (coefficient of variation), где CV = std(intervals) / mean(intervals), обрезанный к диапазону [0, 1]. Значение 1.0 означает идеально равномерный ритм (CV = 0), 0.0 - максимально неравномерный.

## 7. Shot Length Statistics (Статистика длины кадров)

### avg_shot_length
Средняя длительность кадра в секундах, вычисляемая как среднее значение длительностей всех кадров между склейками.

### median_shot_length
Медианная длительность кадра в секундах, более устойчивая к выбросам метрика центральной тенденции.

### short_shots_ratio
Доля коротких кадров (длительность < 1 секунды) от общего количества кадров, показывающая долю быстрых склеек.

### long_shots_ratio
Доля длинных кадров (длительность > 4 секунды) от общего количества кадров, показывающая долю медленных склеек.

### very_long_shots_count
Количество очень длинных кадров (длительность > 10 секунд), указывающее на наличие протяженных сцен без склеек.

### extremely_short_shots_count
Количество крайне коротких кадров (длительность < 0.25 секунды), характерных для быстрого монтажа или meme-стиля.

### shot_length_p10, shot_length_p25, shot_length_p75, shot_length_p90
Перцентили распределения длительностей кадров (10-й, 25-й, 75-й и 90-й перцентили). Позволяют анализировать распределение длительностей кадров более детально, чем только среднее и медиана.

### shot_length_histogram
Нормализованная гистограмма длительностей кадров (8 бинов), представленная как список вероятностей. Компактное представление распределения длительностей кадров для анализа структуры монтажа.

## 8. Scene Detection (Детекция сцен)

### scene_count
Количество сцен в видео. Сцены группируются через семантическую кластеризацию (DBSCAN) на deep embeddings кадров или через аудио-визуальное слияние с использованием аудио событий.

### avg_scene_length_shots
Средняя длина сцены в количестве кадров, вычисляемая как среднее значение количества кадров в каждой сцене.

### scene_to_shot_ratio
Отношение количества сцен к количеству кадров, показывающее плотность группировки кадров в сцены.

### scene_hard_cut_transitions
Количество переходов между сценами, выполненных через жесткие склейки.

### scene_fade_transitions
Количество переходов между сценами, выполненных через fade (fade-in или fade-out).

### scene_dissolve_transitions
Количество переходов между сценами, выполненных через dissolve.

### scene_motion_transitions
Количество переходов между сценами, выполненных через движение-основанные переходы (whip pan, zoom, speed ramp).

### scene_stylized_transitions
Количество переходов между сценами, выполненных через стилизованные переходы (glitch, flash, wipe и т.д.).

## 9. Audio Features (Аудио фичи)

### audio_cut_alignment_score
Оценка синхронизации склеек с аудио событиями, вычисляемая как доля склеек, которые совпадают с аудио onset пиками в окне ±0.5 секунды. Используется динамический порог на основе RMS и кластеризация onset пиков для стабильного сопоставления.

### audio_spike_cut_ratio
Доля значительных аудио пиков от общего количества аудио фреймов. Значительные пики определяются через порог: среднее + стандартное отклонение onset envelope.

### scene_whoosh_transition_prob
Вероятность наличия whoosh-переходов на границах сцен. Детектируется через анализ спектральных фичей: растущий spectral rolloff (высокочастотный sweep), высокий spectral flux (быстрое спектральное изменение) и всплеск высокочастотной энергии (>5000 Hz) в окне ±0.5 секунды вокруг границы сцены.

## 10. Edit Style Classification (Классификация стиля монтажа)

### edit_style_fast_prob
Вероятность стиля "fast-cut montage". Определяется через очень высокую частоту склеек (>20 в минуту), короткие кадры (<2 сек) и высокую вариацию интервалов (std > 0.5).

### edit_style_slow_prob
Вероятность стиля "slow-paced editorial". Определяется через низкую частоту склеек (<8 в минуту), длинные кадры (>5 сек) и равномерный ритм (uniformity > 0.7).

### edit_style_cinematic_prob
Вероятность кинематографического стиля монтажа. Определяется через среднюю частоту склеек (5-15 в минуту), длинные кадры (>3 сек) и высокую долю стилизованных переходов (>20% от всех склеек).

### edit_style_meme_prob
Вероятность meme-стиля монтажа. Определяется через очень короткие кадры (<0.25 сек), очень высокую частоту склеек (>25 в минуту), много jump cuts (>2 в минуту) и хаотичный ритм (uniformity < 0.5).

### edit_style_social_prob
Вероятность стиля социальных сетей. Определяется через высокую частоту jump cuts (>3 в минуту), среднюю-высокую частоту склеек (>15 в минуту) и высокую долю коротких кадров (>30%).

### edit_style_high_action_prob
Вероятность стиля высокого действия (GoPro-стиль). Определяется через высокую долю движение-основанных переходов (>30%), высокую частоту склеек (>18 в минуту) и короткие-средние кадры (1-4 сек).

## 11. CLIP-based Transition Probabilities (Вероятности переходов через CLIP)

### edit_style_hard_cut_prob
Средняя вероятность жестких склеек через CLIP zero-shot классификацию, вычисляемая как среднее значение вероятностей по всем переходам в видео.

### edit_style_fade_prob
Средняя вероятность fade переходов через CLIP классификацию.

### edit_style_dissolve_prob
Средняя вероятность dissolve переходов через CLIP классификацию.

### edit_style_whip_pan_prob
Средняя вероятность whip pan переходов через CLIP классификацию.

### edit_style_zoom_transition_prob
Средняя вероятность zoom переходов через CLIP классификацию.

### edit_style_wipe_transition_prob
Средняя вероятность wipe переходов через CLIP классификацию.

### edit_style_slide_transition_prob
Средняя вероятность slide переходов через CLIP классификацию.

### edit_style_glitch_transition_prob
Средняя вероятность glitch переходов через CLIP классификацию.

### edit_style_flash_transition_prob
Средняя вероятность flash переходов через CLIP классификацию.

### edit_style_luma_wipe_transition_prob
Средняя вероятность luma wipe переходов через CLIP классификацию.

## 12. Detections (Детекции)

### hard_cut_indices
Список индексов кадров, где обнаружены жесткие склейки.

### hard_cut_strengths
Список сил жестких склеек, соответствующих индексам в hard_cut_indices.

### soft_events
Список словарей с информацией о мягких переходах: тип (fade_in/fade_out/dissolve), начальный кадр, конечный кадр и длительность в секундах.

### motion_cut_indices
Список индексов кадров, где обнаружены движение-основанные переходы.

### motion_cut_intensities
Список интенсивностей движение-основанных переходов, соответствующих индексам в motion_cut_indices.

### motion_cut_types
Список типов движение-основанных переходов ('whip_pan', 'zoom', 'speed_ramp'), соответствующих индексам в motion_cut_indices.

### stylized_counts
Словарь с количеством каждого типа стилизованных переходов, обнаруженных через CLIP классификацию.

### jump_cut_indices
Список индексов кадров, где обнаружены прыжковые склейки.

### jump_cut_scores
Список оценок прыжковых склеек, соответствующих индексам в jump_cut_indices.

### shot_boundaries_frames
Список индексов кадров, являющихся границами кадров (shots), включая начало и конец видео.

### scene_boundaries_shot_idx
Список кортежей (start_shot_idx, end_shot_idx), определяющих границы сцен в терминах индексов кадров.

