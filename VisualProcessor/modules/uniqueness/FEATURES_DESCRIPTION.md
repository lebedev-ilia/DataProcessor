# Описание фичей модуля uniqueness

Модуль вычисляет степень уникальности видео по различным аспектам, сравнивая текущее видео с референсными/топовыми видео и вычисляя novelty scores.

## Baseline v1 (текущая реализация в пайплайне)

Для baseline (первый цикл) модуль работает в режиме **intra-video uniqueness**:
- **без reference-видео**
- использует только `core_clip` embeddings на sampled frames
- считает proxy-метрики:
  - `repetition_ratio` (доля кадров, похожих на другие кадры выше порога)
  - `pairwise_sim_mean/p95` (средняя/95p схожесть внутри видео)
  - `temporal_change_mean/std` (динамика семантики по времени)
  - `diversity_score`

## 1. Semantic / Content Novelty

### semantic_novelty_score
Семантическая новизна контента. Основная метрика: `semantic_novelty_score = 1.0 - max_similarity` с референсными видео (cosine similarity по video_embedding). Показывает, насколько уникально видео по семантике (выше = более уникально).

### semantic_novelty_max
То же, что и `semantic_novelty_score` — 1.0 - max cosine similarity к референсному сету.

### semantic_novelty_topk_mean
Новизна по среднему среди топ-K (по умолчанию K=5) наиболее похожих референсов:  
`semantic_novelty_topk_mean = 1.0 - mean(topK_similarities)`. Более устойчива к единичным совпадениям.

### semantic_novelty_topk_median
Новизна по медиане среди топ-K наиболее похожих референсов:  
`semantic_novelty_topk_median = 1.0 - median(topK_similarities)`. Менее чувствительна к выбросам, чем среднее.

### topic_novelty_score
Новизна тем. Вычисляется как доля новых концептов, которых нет в популярных видео. Показывает, насколько уникальны темы видео.

### concept_diversity_score
Разнообразие концептов (alias для энтропийной версии). Вычисляется через нормированную энтропию распределения тем (если темы представлены как распределение вероятностей).

### concept_diversity_entropy
Нормированная энтропия распределения тем (0..1). Высокое значение означает, что видео покрывает широкий спектр тем (нет доминирующей одной).

### concept_diversity_unique_norm
Нормализованная мощность поддержки тем: количество "существенных" тем (p>0.01) или уникальных topic-идентификаторов, делённое на \(\log(1+N)\), где \(N\) — общее число тем или сегментов. Показывает, насколько много разных тем используется с учётом длины видео.

## 2. Visual / Style Novelty

### color_palette_novelty
Новизна цветовой палитры. Вычисляется как 1.0 - средняя схожесть цветовых гистограмм с референсными видео. Показывает уникальность цветового решения.

### lighting_style_novelty
Новизна стиля освещения. Вычисляется как 1.0 - средняя схожесть фичей освещения. Показывает уникальность освещения.

### shot_type_novelty
Новизна типов кадров. Вычисляется через Earth Mover's Distance между распределениями типов кадров. Показывает уникальность композиции кадров.

### camera_motion_novelty
Новизна движения камеры. Вычисляется через корреляцию паттернов движения камеры. Показывает уникальность операторской работы.

## 3. Editing & Pacing Novelty

### cut_rate_novelty
Новизна частоты склеек. Вычисляется через нормализованную разницу частот склеек. Показывает уникальность монтажа.

### shot_duration_distribution_novelty
Новизна распределения длительностей кадров. Вычисляется через Earth Mover's Distance между распределениями. Показывает уникальность ритма монтажа.

### scene_length_novelty
Новизна длительностей сцен. Вычисляется через сравнение средних и стандартных отклонений длительностей сцен. Показывает уникальность структуры видео.

### pacing_pattern_novelty
Новизна паттерна pacing. Вычисляется через корреляцию кривых pacing. Показывает уникальность временного ритма.

## 4. Audio Novelty

### music_track_novelty
Новизна музыкального трека. Вычисляется как 1.0 - схожесть аудио embeddings. Показывает уникальность музыкального сопровождения.

### voice_style_novelty
Новизна стиля голоса. Вычисляется как 1.0 - схожесть voice embeddings или через разницу темпов. Показывает уникальность голосовых характеристик.

### sound_effects_novelty
Новизна звуковых эффектов. Вычисляется как 1.0 - схожесть фичей звуковых эффектов. Показывает уникальность звукового дизайна.

### audio_energy_pattern_novelty
Новизна паттерна аудио энергии. Вычисляется через корреляцию кривых энергии. Показывает уникальность динамики аудио.

## 5. Text / OCR Novelty

### ocr_text_novelty
Новизна OCR текста. Вычисляется как 1.0 - схожесть OCR embeddings. Показывает уникальность текстового контента.

### text_layout_novelty
Новизна расположения текста. Вычисляется как 1.0 - схожесть фичей layout. Показывает уникальность оформления текста.

### text_style_novelty
Новизна стиля текста. Вычисляется как 1.0 - схожесть фичей стиля (шрифты, цвета, эффекты). Показывает уникальность визуального стиля текста.

## 6. Behavioral & Motion Novelty

### pose_motion_novelty
Новизна движения поз. Вычисляется как 1.0 - схожесть фичей движения поз. Показывает уникальность движений людей.

### object_interaction_novelty
Новизна взаимодействия с объектами. Вычисляется как 1.0 - схожесть фичей взаимодействия. Показывает уникальность поведенческих паттернов.

### action_sequence_novelty
Новизна последовательности действий. Вычисляется через корреляцию последовательностей действий. Показывает уникальность сюжетных действий.

## 7. Multimodal Novelty

### multimodal_novelty_score
Мультимодальная новизна. Вычисляется как взвешенная сумма новизны по всем модальностям (semantic, visual, editing, audio, text, behavioral). Показывает общую мультимодальную уникальность.

### novel_event_alignment_score
Оценка новых событий. Вычисляется как доля новых типов событий, которых нет в референсных видео. Показывает уникальность ключевых моментов.

### overall_novelty_index
Общий индекс новизны. Вычисляется как взвешенная сумма всех метрик новизны с учетом весов:
- semantic: 20%
- visual: 15%
- editing: 15%
- audio: 10%
- text: 10%
- behavioral: 10%
- multimodal: 15%
- temporal: 5%

## 8. Temporal / Trend Novelty

### trend_alignment_score
Оценка соответствия трендам. Показывает, насколько видео соответствует текущим трендам (низкий = уникально). Может быть вычислена через similarity scores или метаданные.

### historical_similarity_score
Схожесть с историческим контентом. Показывает схожесть с прошлым контентом (может использоваться дата создания для сравнения).

### early_adopter_score
Оценка новаторства. Вычисляется как 1.0 - trend_alignment_score. Показывает, насколько видео новаторское в своей нише.

## Методы вычисления

1. **Novelty = 1 - Similarity**: Большинство метрик новизны вычисляются как обратная схожесть (1.0 - similarity).
2. **Distance Metrics**: Используется Earth Mover's Distance для сравнения распределений.
3. **Correlation**: Используется корреляция Пирсона для сравнения временных кривых.
4. **Set Difference**: Используется разность множеств для сравнения тем и событий.
5. **Weighted Aggregation**: Финальные метрики агрегируются через взвешенные суммы.

## Зависимости

- **numpy**: Для численных вычислений
- **scipy**: Для статистических метрик (correlation, distance, entropy)
- **sklearn**: Для вычисления схожести

## Использование

Модуль требует:
- **video_embedding**: Embedding текущего видео (может быть получен из high_level_semantic модуля)
- **reference_embeddings**: Список embeddings референсных видео (из файла JSON)
- Опционально: фичи из других модулей для более детального анализа

Модуль может использовать данные из других модулей через флаги:
- `--use-high-level-semantic`: Использовать результаты high_level_semantic для video embedding
- `--use-similarity-metrics`: Использовать результаты similarity_metrics для similarity scores
- `--use-visual-features`: Использовать визуальные фичи из других модулей
- `--use-pacing-features`: Использовать фичи pacing из video_pacing модуля
- `--use-text-features`: Использовать текстовые фичи из text_scoring модуля
- `--use-audio-features`: Использовать аудио фичи
- `--use-behavior-features`: Использовать поведенческие фичи из behavioral модуля

