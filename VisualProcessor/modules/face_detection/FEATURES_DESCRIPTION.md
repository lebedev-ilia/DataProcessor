# Описание фичей модуля face_detection

## frames_with_face

Список индексов кадров видео, в которых обнаружено хотя бы одно лицо с уровнем уверенности (confidence score) выше или равным порогу detect_thr (по умолчанию 0.3).

### Алгоритм:

Модуль использует библиотеку InsightFace (FaceAnalysis) для детекции лиц. Для каждого кадра видео:

1. **Инициализация модели**: Модуль автоматически пытается использовать GPU (CUDAExecutionProvider), при неудаче переключается на CPU (CPUExecutionProvider). Размер детекции по умолчанию 640x640 пикселей.

2. **Детекция лиц**: На вход подается BGR кадр (OpenCV формат), модель возвращает список обнаруженных лиц.

3. **Извлечение confidence score**: Для каждого обнаруженного лица извлекается score (уверенность детекции) через безопасный метод safe_det_score, который проверяет наличие атрибутов det_score или score.

4. **Выбор максимального score**: Из всех обнаруженных лиц в кадре выбирается максимальный confidence score.

5. **Фильтрация по порогу**: Кадр считается содержащим лицо, если максимальный score >= detect_thr. Индекс кадра добавляется в список frames_with_face.

### Особенности:

- Модуль работает только на уровне детекции наличия лиц, без детальной информации о положении, ключевых точках или атрибутах лиц.
- Порог по умолчанию 0.3 позволяет отфильтровать ложные срабатывания, но может пропустить лица с низким качеством изображения.
- Размер детекции (det_size) влияет на скорость и точность: больший размер повышает точность, но замедляет обработку.

